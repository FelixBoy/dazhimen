<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dazhimen.bg.bean.Product">
    <select id="listAllProduct" resultType="dazhimen.bg.bean.ListViewProductBean">
       select pid,pname,getcodetxt('producttype',a.type) type,
               getcodetxt('productstatus',a.status) status,a.status statusnum,
               date_format(a.createdatetime,'%Y-%m-%d %H:%i:%s') createtime,b.name uname
        from product a, user b
       where a.uid = b.uid and a.isdel = '0'
       order by a.indexsort,createdatetime desc
    </select>

    <select id="getProductInforById" resultType="dazhimen.bg.bean.ViewProductBean">
        select pid,pname,getcodetxt('producttype',a.type) as type,price,derateProportion,
                a.introduction,getcodetxt('indexsort',a.indexsort) as indexsort,getcodetxt('rightorwrong',indexplay) as indexplay,
                listimage,b.uid,b.name as uname,b.mphone,b.loginname,getcodetxt('gender',b.gender) as gender
          from product a,user b
        where a.uid = b.uid
          and pid = #{pid}
          and a.isdel = '0'
    </select>

    <insert id="saveAddProduct" parameterType="dazhimen.bg.bean.UploadProductBean">
        insert into product(pid,pname,type,price,derateProportion,introduction,
                            indexplay,indexsort,uid,createdatetime,listimage,updatedatetime)
              values(#{pid},  #{pname}  ,#{type},  #{price}, #{derateProportion},  #{introduction},
                            #{indexPlay},#{indexSort},#{uid},now(),#{listimage},now())
    </insert>

    <insert id="saveAddProductImage" parameterType="dazhimen.bg.bean.AddProductImageBean">
        insert into product_image(imageid,path,pid)
                        values(#{imageid},    #{path},   #{pid})
    </insert>

    <select id="getCourseInforByCourseid" resultType="dazhimen.bg.bean.UploadCourseBean">
        select pid,courseid,coursename,sort,istry
          from course
        where courseid = #{courseid}
    </select>

    <select id="queryAllCourseByPid" resultType="dazhimen.bg.bean.ListViewCourseBean">
        select courseid,coursename,getcodetxt('indexsort',sort) as sort,
                getcodetxt('rightorwrong',istry) as istry,audiopath as audiourl
          from course where pid = #{pid}
    </select>

    <select id="getMasterDataByUid" resultType="dazhimen.bg.bean.UserBean">
        select uid,name,mphone,gender,loginname,date_format(createdate,'%Y-%m-%d %H:%i:%s') as createDatestr,remarks
          from user
        where uid = #{uid}
    </select>

    <select id="listAllMasters" resultType="dazhimen.bg.bean.UserBean">
        select uid,name,mphone,getcodetxt('gender',gender) gender,loginname,remarks
          from user where type = '1' and isdel = '0'
    </select>

    <delete id="saveCourseDel">
        delete from course where courseid = #{courseid}
    </delete>

    <update id="saveModifyCourse" parameterType="dazhimen.bg.bean.UploadCourseBean">
        update course
          set coursename = #{coursename},istry = #{istry}, sort = #{sort},updatetime=now()
        where courseid =  #{courseid}
    </update>

    <insert id="saveAddCourse" parameterType="dazhimen.bg.bean.UploadCourseBean">
        insert into course(courseid,coursename,istry,sort,audiopath,createdate,updatetime,pid)
        values(#{courseid}, #{coursename},  #{istry},  #{sort}, #{audiopath}, now() , now(), #{pid})
    </insert>

    <select id="getProductMainImages" resultType="dazhimen.bg.bean.ViewMainImageBean">
          select imageid,path as mainimage
            from product_image
          where pid = #{pid}
    </select>

    <update id="saveModifyProductStatus" parameterType="dazhimen.bg.bean.ModifyProductStatusBean">
        update product set status = #{status} where pid = #{pid}
    </update>

    <delete id="saveProductImageDel">
         delete from product_image where pid = #{pid}
    </delete>

    <delete id="saveCourseDelByPid">
        delete from course where pid = #{pid}
    </delete>

    <update id="saveProductDel">
        update product set isdel = '1' where pid = #{pid}
    </update>
</mapper>